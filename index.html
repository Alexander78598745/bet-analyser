<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bet Analyser AI - Pro</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --accent: #10b981; --secondary: #3b82f6; --danger: #ef4444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .app { width: 100%; max-width: 650px; background: var(--card); padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: var(--accent); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        select, input { width: 100%; padding: 12px; margin: 5px 0 15px 0; background: #334155; border: 1px solid #475569; color: white; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; transition: 0.2s; }
        button:hover { background: #059669; transform: translateY(-2px); }
        
        .result-section { background: #0f172a; padding: 20px; margin-top: 25px; border-radius: 10px; display: none; border-left: 5px solid var(--accent); }
        .bar-container { background: #334155; height: 20px; border-radius: 5px; margin: 8px 0; position: relative; overflow: hidden; }
        .bar { height: 100%; background: var(--accent); width: 0%; transition: width 0.8s ease; }
        .bar-text { position: absolute; right: 10px; top: 1px; font-size: 12px; font-weight: bold; }
        .value-box { padding: 10px; border-radius: 5px; margin-top: 10px; font-weight: bold; text-align: center; font-size: 14px; }
    </style>
</head>
<body>

<div class="app">
    <h1>⚽ Bet Analyser AI v2</h1>
    <p id="status" style="text-align:center; font-size:12px; color:#94a3b8;">Sincronizando con Alexander78598745...</p>

    <label>1. Seleccionar Liga</label>
    <select id="leagueSelect" onchange="filterTeams()"></select>

    <div class="grid">
        <div><label>Equipo Local</label><select id="homeTeam"></select></div>
        <div><label>Equipo Visitante</label><select id="awayTeam"></select></div>
    </div>

    <div class="grid">
        <div><label>Cuota Local (1)</label><input type="number" id="odd1" step="0.01" placeholder="Ej: 2.10"></div>
        <div><label>Cuota Más 2.5 Goles</label><input type="number" id="oddOver" step="0.01" placeholder="Ej: 1.95"></div>
    </div>

    <button onclick="calculate()">REALIZAR ANÁLISIS COMPLETO</button>

    <div id="results1" class="result-section">
        <h3 id="matchTitle" style="text-align:center; margin-top:0;"></h3>
        <p>Probabilidad de Ganador (1X2)</p>
        <div class="bar-container"><div id="barL" class="bar"></div><span id="txtL" class="bar-text"></span></div>
        <div id="value1" class="value-box"></div>
    </div>

    <div id="resultsGoles" class="result-section" style="border-left-color: var(--secondary);">
        <p>Probabilidad de Goles (Más de 2.5)</p>
        <div class="bar-container"><div id="barOver" class="bar" style="background: var(--secondary);"></div><span id="txtOver" class="bar-text"></span></div>
        <div id="valueOver" class="value-box"></div>
    </div>
</div>

<script>
    const DB_URL = 'https://raw.githubusercontent.com/Alexander78598745/bet-analyser/main/equipos.json';
    let db = {};

    async function init() {
        try {
            const req = await fetch(DB_URL);
            db = await req.json();
            const leagues = [...new Set(Object.values(db).map(x => x.liga))].sort();
            const sel = document.getElementById('leagueSelect');
            sel.innerHTML = '<option value="">-- Elige Liga --</option>';
            leagues.forEach(l => sel.add(new Option(l, l)));
            document.getElementById('status').innerText = "✅ Base de Datos 2025/2026 Lista";
        } catch(e) { document.getElementById('status').innerText = "❌ Error al cargar datos"; }
    }

    function filterTeams() {
        const league = document.getElementById('leagueSelect').value;
        const h = document.getElementById('homeTeam'); const a = document.getElementById('awayTeam');
        h.innerHTML = ''; a.innerHTML = '';
        Object.keys(db).filter(k => db[k].liga === league).sort().forEach(t => {
            h.add(new Option(t, t)); a.add(new Option(t, t));
        });
    }

    function fact(n) { return n<=1?1:n*fact(n-1); }
    function p_dist(k, l) { return (Math.pow(l, k) * Math.exp(-l)) / fact(k); }

    function calculate() {
        const hName = document.getElementById('homeTeam').value;
        const vName = document.getElementById('awayTeam').value;
        const odd1 = parseFloat(document.getElementById('odd1').value);
        const oddOver = parseFloat(document.getElementById('oddOver').value);

        if(!hName || !vName) return;

        // xG (Goles Esperados)
        const xGH = (db[hName].ga * 1.10 + db[vName].gc) / 2;
        const xGV = (db[vName].ga / 1.10 + db[hName].gc) / 2;

        let pL=0, pD=0, pV=0, pUnder25=0;

        for(let i=0; i<8; i++) {
            for(let j=0; j<8; j++) {
                let p = p_dist(i, xGH) * p_dist(j, xGV);
                // Probabilidades 1X2
                if(i>j) pL+=p; else if(i==j) pD+=p; else pV+=p;
                // Probabilidad Under 2.5 (0-0, 1-0, 0-1, 1-1, 2-0, 0-2)
                if((i+j) < 2.5) pUnder25 += p;
            }
        }

        const pOver25 = 1 - pUnder25;

        // Mostrar Resultados
        document.getElementById('results1').style.display = 'block';
        document.getElementById('resultsGoles').style.display = 'block';
        document.getElementById('matchTitle').innerText = `${hName} vs ${vName}`;

        // UI 1X2
        updateUI('L', pL, odd1, 'value1', 'Victoria Local');
        // UI Goles
        updateUI('Over', pOver25, oddOver, 'valueOver', 'Más de 2.5 Goles');
    }

    function updateUI(id, prob, odd, valueId, label) {
        const pct = (prob * 100).toFixed(1);
        document.getElementById('bar' + id).style.width = pct + '%';
        document.getElementById('txt' + id).innerText = pct + '%';

        const vBox = document.getElementById(valueId);
        if(odd > 0) {
            let edge = (prob * odd) - 1;
            if(edge > 0) {
                vBox.style.background = 'rgba(16, 185, 129, 0.2)';
                vBox.style.color = '#10b981';
                vBox.innerText = `VALOR DETECTADO EN ${label.toUpperCase()}: +${(edge*100).toFixed(1)}%`;
            } else {
                vBox.style.background = 'rgba(239, 68, 68, 0.1)';
                vBox.style.color = '#94a3b8';
                vBox.innerText = `Sin valor para ${label}`;
            }
        } else { vBox.innerText = ""; }
    }

    window.onload = init;
</script>
</body>
</html>
